FTPD.CONF(5)              NetBSD File Formats Manual              FTPD.CONF(5)

NNAAMMEE
     ffttppdd..ccoonnff -- tnftpd(8) configuration file

DDEESSCCRRIIPPTTIIOONN
     The ffttppdd..ccoonnff file specifies various configuration options for tnftpd(8)
     that apply once a user has authenticated their connection.

     ffttppdd..ccoonnff consists of a series of lines, each of which may contain a con-
     figuration directive, a comment, or a blank line.  Directives that appear
     later in the file override settings by previous directives.  This allows
     `wildcard' entries to define defaults, and then have class-specific over-
     rides.

     A directive line has the format:
           command class [arguments]

     A ``\'' is the escape character; it can be used to escape the meaning of
     the comment character, or if it is the last character on a line, extends
     a configuration directive across multiple lines.  A ``#'' is the comment
     character, and all characters from it to the end of line are ignored
     (unless it is escaped with the escape character).

     Each authenticated user is a member of a _c_l_a_s_s, which is determined by
     ftpusers(5).  _c_l_a_s_s is used to determine which ffttppdd..ccoonnff entries apply to
     the user.  The following special classes exist when parsing entries in
     ffttppdd..ccoonnff:
           aallll     Matches any class.
           nnoonnee    Matches no class.

     Each class has a type, which may be one of:

           GGUUEESSTT   Guests (as per the ``anonymous'' and ``ftp'' logins).  A
                   chroot(2) is performed after login.

           CCHHRROOOOTT  chroot(2)ed users (as per ftpchroot(5)).  A chroot(2) is
                   performed after login.

           RREEAALL    Normal users.

     The tnftpd(8) SSTTAATT command will return the class settings for the current
     user as defined by ffttppdd..ccoonnff, unless the pprriivvaattee directive is set for the
     class.

     Each configuration line may be one of:

     aaddvveerrttiizzee _c_l_a_s_s [_h_o_s_t]
           Set the address to advertise in the response to the PPAASSVV and LLPPSSVV
           commands to the address for _h_o_s_t (which may be either a host name
           or IP address).  This may be useful in some firewall configura-
           tions, although many ftp clients may not work if the address being
           advertised is different to the address that they've connected to.
           If _c_l_a_s_s is ``none'' or _h_o_s_t not is specified, disable this.

     cchheecckkppoorrttccmmdd _c_l_a_s_s [ooffff]
           Check the PPOORRTT command for validity.  The PPOORRTT command will fail if
           the IP address specified does not match the FTP command connection,
           or if the remote TCP port number is less than IPPORT_RESERVED.  It
           is _s_t_r_o_n_g_l_y encouraged that this option be used, especially for
           sites concerned with potential security problems with FTP bounce
           attacks.  If _c_l_a_s_s is ``none'' or ooffff is specified, disable this
           feature, otherwise enable it.

     cchhrroooott _c_l_a_s_s [ppaatthhffoorrmmaatt]
           If _p_a_t_h_f_o_r_m_a_t is not specified or _c_l_a_s_s is ``none'', use the
           default behavior (see below).  Otherwise, _p_a_t_h_f_o_r_m_a_t is parsed to
           create a directory to create as the root directory with chroot(2)
           into upon login.

           _p_a_t_h_f_o_r_m_a_t can contain the following escape strings:
                 EEssccaappee  DDeessccrriippttiioonn
                 %c      Class name.
                 %d      Home directory of user.
                 %u      User name.
                 %%      A ``%'' character.

           The default root directory is:
                 CCHHRROOOOTT  The user's home directory.
                 GGUUEESSTT   If --aa _a_n_o_n_d_i_r is specified, use _a_n_o_n_d_i_r, otherwise
                         the home directory of the `ftp' user.
                 RREEAALL    By default no chroot(2) is performed.

     ccllaassssttyyppee _c_l_a_s_s _t_y_p_e
           Set the class type of _c_l_a_s_s to _t_y_p_e (see above).

     ccoonnvveerrssiioonn _c_l_a_s_s _s_u_f_f_i_x [_t_y_p_e _d_i_s_a_b_l_e _c_o_m_m_a_n_d]
           Define an automatic in-line file conversion.  If a file to retrieve
           ends in _s_u_f_f_i_x, and a real file (sans _s_u_f_f_i_x) exists, then the out-
           put of _c_o_m_m_a_n_d is returned instead of the contents of the file.

                 _s_u_f_f_i_x   The suffix to initiate the conversion.

                 _t_y_p_e     A list of valid filetypes for the conversion.  Valid
                          types are: `f' (file), and `d' (directory).

                 _d_i_s_a_b_l_e  The name of file that will prevent conversion if it
                          exists.  A file name of ``_.'' will prevent this dis-
                          abling action (i.e., the conversion is always per-
                          mitted.)

                 _c_o_m_m_a_n_d  The command to run for the conversion.  The first
                          word should be the full path name of the command, as
                          execv(3) is used to execute the command.  All
                          instances of the word ``%s'' in _c_o_m_m_a_n_d are replaced
                          with the requested file (sans _s_u_f_f_i_x).

           Conversion directives specified later in the file override earlier
           conversions with the same suffix.

     ddeennyyqquuiicckk _c_l_a_s_s [ooffff]
           Enforce ftpusers(5) rules after the UUSSEERR command is received,
           rather than after the PPAASSSS command is received.  Whilst enabling
           this feature may allow information leakage about available accounts
           (for example, if you allow some users of a RREEAALL or CCHHRROOOOTT class but
           not others), it is useful in preventing a denied user (such as
           `root') from entering their password across an insecure connection.
           This option is _s_t_r_o_n_g_l_y recommended for servers which run an anony-
           mous-only service.  If _c_l_a_s_s is ``none'' or ooffff is specified, dis-
           able this feature, otherwise enable it.

     ddiissppllaayy _c_l_a_s_s [_f_i_l_e]
           If _f_i_l_e is not specified or _c_l_a_s_s is ``none'', disable this.  Oth-
           erwise, each time the user enters a new directory, check if _f_i_l_e
           exists, and if so, display its contents to the user.  Escape
           sequences are supported; refer to _D_i_s_p_l_a_y _f_i_l_e _e_s_c_a_p_e _s_e_q_u_e_n_c_e_s in
           tnftpd(8) for more information.

     hhiiddeessyymmlliinnkkss _c_l_a_s_s [ooffff]
           If _c_l_a_s_s is ``none'' or ooffff is specified, disable this feature.
           Otherwise, the LLIISSTT command lists symbolic links as the file or
           directory the link references (``ls -LlA'').  Servers which run an
           anonymous service may wish to enable this feature for GGUUEESSTT users,
           so that symbolic links do not leak names in directories that are
           not searchable by GGUUEESSTT users.

     hhoommeeddiirr _c_l_a_s_s [ppaatthhffoorrmmaatt]
           If _p_a_t_h_f_o_r_m_a_t is not specified or _c_l_a_s_s is ``none'', use the
           default behavior (see below).  Otherwise, _p_a_t_h_f_o_r_m_a_t is parsed to
           create a directory to change into upon login, and to use as the
           `home' directory of the user for tilde expansion in pathnames, etc.
           _p_a_t_h_f_o_r_m_a_t is parsed as per the cchhrroooott directive.

           The default home directory is the home directory of the user for
           RREEAALL users, and _/ for GGUUEESSTT and CCHHRROOOOTT users.

     lliimmiitt _c_l_a_s_s [_c_o_u_n_t [_f_i_l_e]]
           Limit the maximum number of concurrent connections for _c_l_a_s_s to
           _c_o_u_n_t, with `-1' meaning unlimited connections.  If the limit is
           exceeded and _f_i_l_e is specified, display its contents to the user.
           If _c_l_a_s_s is ``none'' or _c_o_u_n_t is not specified, disable this.  If
           _f_i_l_e is a relative path, it will be searched for in _/_e_t_c (which can
           be overridden with --cc _c_o_n_f_d_i_r).

     mmaaxxffiilleessiizzee _c_l_a_s_s [_s_i_z_e]
           Set the maximum size of an uploaded file to _s_i_z_e, with `-1' meaning
           unlimited connections.  If _c_l_a_s_s is ``none'' or _s_i_z_e is not speci-
           fied, disable this.

     mmaaxxttiimmeeoouutt _c_l_a_s_s [_t_i_m_e]
           Set the maximum timeout period that a client may request, default-
           ing to two hours.  This cannot be less than 30 seconds, or the
           value for ttiimmeeoouutt.  If _c_l_a_s_s is ``none'' or _t_i_m_e is not specified,
           use the default.

     mmmmaappssiizzee _c_l_a_s_s [_s_i_z_e]
           Set the size of the sliding window to map a file using mmap(2).  If
           zero, tnftpd(8) will use read(2) instead.  The default is zero.  An
           optional suffix may be provided as per rraatteeggeett.  This option
           affects only binary transfers.  If _c_l_a_s_s is ``none'' or _s_i_z_e is not
           specified, use the default.

     mmooddiiffyy _c_l_a_s_s [ooffff]
           If _c_l_a_s_s is ``none'' or ooffff is specified, disable the following
           commands: CCHHMMOODD, DDEELLEE, MMKKDD, RRMMDD, RRNNFFRR, and UUMMAASSKK.  Otherwise,
           enable them.

     mmoottdd _c_l_a_s_s [_f_i_l_e]
           If _f_i_l_e is not specified or _c_l_a_s_s is ``none'', disable this.  Oth-
           erwise, use _f_i_l_e as the message of the day file to display after
           login.  Escape sequences are supported; refer to _D_i_s_p_l_a_y _f_i_l_e
           _e_s_c_a_p_e _s_e_q_u_e_n_c_e_s in tnftpd(8) for more information.  If _f_i_l_e is a
           relative path, it will be searched for in _/_e_t_c (which can be over-
           ridden with --cc _c_o_n_f_d_i_r).

     nnoottiiffyy _c_l_a_s_s [_f_i_l_e_g_l_o_b]
           If _f_i_l_e_g_l_o_b is not specified or _c_l_a_s_s is ``none'', disable this.
           Otherwise, each time the user enters a new directory, notify the
           user of any files matching _f_i_l_e_g_l_o_b.

     ppaassssiivvee _c_l_a_s_s [ooffff]
           If _c_l_a_s_s is ``none'' or ooffff is specified, prevent passive (PPAASSVV,
           LLPPSSVV, and EEPPSSVV) connections.  Otherwise, enable them.

     ppoorrttrraannggee _c_l_a_s_s [_m_i_n _m_a_x]
           Set the range of port number which will be used for the passive
           data port.  _m_a_x must be greater than _m_i_n, and both numbers must be
           be between IPPORT_RESERVED (1024) and 65535.  If _c_l_a_s_s is ``none''
           or no arguments are specified, disable this.

     pprriivvaattee _c_l_a_s_s [ooffff]
           If _c_l_a_s_s is ``none'' or ooffff is specified, do not display class
           information in the output of the SSTTAATT command.  Otherwise, display
           the information.

     rraatteeggeett _c_l_a_s_s [_r_a_t_e]
           Set the maximum get (RREETTRR) transfer rate throttle for _c_l_a_s_s to _r_a_t_e
           bytes per second.  If _r_a_t_e is 0, the throttle is disabled.  If
           _c_l_a_s_s is ``none'' or _r_a_t_e is not specified, disable this.

           An optional suffix may be provided, which changes the interpreta-
           tion of _r_a_t_e as follows:
                 b    Causes no modification.  (Default; optional)
                 k    Kilo; multiply the argument by 1024
                 m    Mega; multiply the argument by 1048576
                 g    Giga; multiply the argument by 1073741824
                 t    Tera; multiply the argument by 1099511627776

     rraatteeppuutt _c_l_a_s_s [_r_a_t_e]
           Set the maximum put (SSTTOORR) transfer rate throttle for _c_l_a_s_s to _r_a_t_e
           bytes per second, which is parsed as per rraatteeggeett _r_a_t_e.  If _c_l_a_s_s is
           ``none'' or _r_a_t_e is not specified, disable this.

     rreeaaddssiizzee _c_l_a_s_s [_s_i_z_e]
           Set the size of the read buffer to read(2) a file.  The default is
           the file system block size.  An optional suffix may be provided as
           per rraatteeggeett.  This option affects only binary transfers.  If _c_l_a_s_s
           is ``none'' or _s_i_z_e is not specified, use the default.

     rreeccvvbbuuffssiizzee _c_l_a_s_s [_s_i_z_e]
           Set the size of the socket receive buffer.  An optional suffix may
           be provided as per rraatteeggeett.  The default is zero and the system
           default value will be used.  This option affects only passive
           transfers.  If _c_l_a_s_s is ``none'' or _s_i_z_e is not specified, use the
           default.

     ssaanneennaammeess _c_l_a_s_s [ooffff]
           If _c_l_a_s_s is ``none'' or ooffff is specified, allow uploaded file names
           to contain any characters valid for a file name.  Otherwise, only
           permit file names which don't start with a `.' and only comprise of
           characters from the set ``[-+,._A-Za-z0-9]''.

     sseennddbbuuffssiizzee _c_l_a_s_s [_s_i_z_e]
           Set the size of the socket send buffer.  An optional suffix may be
           provided as per rraatteeggeett.  The default is zero and the system
           default value will be used.  This option affects only binary trans-
           fers.  If _c_l_a_s_s is ``none'' or _s_i_z_e is not specified, use the
           default.

     sseennddlloowwaatt _c_l_a_s_s [_s_i_z_e]
           Set the low water mark of socket send buffer.  An optional suffix
           may be provided as per rraatteeggeett.  The default is zero and system
           default value will be used.  This option affects only for binary
           transfer.  If _c_l_a_s_s is ``none'' or _s_i_z_e is not specified, use the
           default.

     tteemmppllaattee _c_l_a_s_s [_r_e_f_c_l_a_s_s]
           Define _r_e_f_c_l_a_s_s as the `template' for _c_l_a_s_s; any reference to
           _r_e_f_c_l_a_s_s in following directives will also apply to members of
           _c_l_a_s_s.  This is useful to define a template class so that other
           classes which are to share common attributes can be easily defined
           without unnecessary duplication.  There can be only one template
           defined at a time.  If _r_e_f_c_l_a_s_s is not specified, disable the tem-
           plate for _c_l_a_s_s.

     ttiimmeeoouutt _c_l_a_s_s [_t_i_m_e]
           Set the inactivity timeout period.  (the default is fifteen min-
           utes).  This cannot be less than 30 seconds, or greater than the
           value for mmaaxxttiimmeeoouutt.  If _c_l_a_s_s is ``none'' or _t_i_m_e is not speci-
           fied, use the default.

     uummaasskk _c_l_a_s_s [_u_m_a_s_k_v_a_l]
           Set the umask to _u_m_a_s_k_v_a_l.  If _c_l_a_s_s is ``none'' or _u_m_a_s_k_v_a_l is not
           specified, set to the default of 027.

     uuppllooaadd _c_l_a_s_s [ooffff]
           If _c_l_a_s_s is ``none'' or ooffff is specified, disable the following
           commands: AAPPPPEE, SSTTOORR, and SSTTOOUU, as well as the modify commands:
           CCHHMMOODD, DDEELLEE, MMKKDD, RRMMDD, RRNNFFRR, and UUMMAASSKK.  Otherwise, enable them.

     wwrriitteessiizzee _c_l_a_s_s [_s_i_z_e]
           Limit the number of bytes to write(2) at a time.  The default is
           zero, which means all the data available as a result of mmap(2) or
           read(2) will be written at a time.  An optional suffix may be pro-
           vided as per rraatteeggeett.  This option affects only binary transfers.
           If _c_l_a_s_s is ``none'' or _s_i_z_e is not specified, use the default.

DDEEFFAAUULLTTSS
     The following defaults are used:

           checkportcmd  all
           classtype     chroot CHROOT
           classtype     guest  GUEST
           classtype     real   REAL
           display       none
           limit         all    -1     # unlimited connections
           maxtimeout    all    7200   # 2 hours
           modify        all
           motd          all    motd
           notify        none
           passive       all
           timeout       all    900    # 15 minutes
           umask         all    027
           upload        all
           modify        guest  off
           umask         guest  0707

FFIILLEESS
     /etc/ftpd.conf                      This file.
     /usr/share/examples/ftpd/ftpd.conf  A sample ffttppdd..ccoonnff file.

SSEEEE AALLSSOO
     strsuftoll(3), ftpchroot(5), ftpusers(5), tnftpd(8)

HHIISSTTOORRYY
     The ffttppdd..ccoonnff functionality was implemented in NetBSD 1.3 and later
     releases by Luke Mewburn, based on work by Simon Burge.

NetBSD 3.0.1                    August 24, 2005                   NetBSD 3.0.1
