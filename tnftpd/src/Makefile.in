#	$NetBSD: Makefile.in,v 1.8 2008/09/27 04:56:56 lukem Exp $
#

PROG	= tnftpd@EXEEXT@
SRCS	= cmds.c conf.c ftpd.c ftpcmd.c popen.c @LSOBJS@
# removed: logutmp.o logwtmp.o

MAN	= ftpd.conf.man ftpusers.man tnftpd.man
CAT	= ${MAN:.man=.cat}


srcdir	= @srcdir@
VPATH	= @srcdir@
SHELL	= /bin/sh

prefix	= @prefix@
exec_prefix = @exec_prefix@
bindir	= @bindir@
datadir	= @datadir@
datarootdir = @datarootdir@
mandir	= @mandir@
sbindir	= @sbindir@
sysconfdir = @sysconfdir@

man5dir	= ${mandir}/man5
man8dir	= ${mandir}/man8
man5ext	= .5
man8ext	= .8
cat5dir	= ${mandir}/cat5
cat8dir	= ${mandir}/cat8
cat5ext	= .0
cat8ext	= .0


CC	= @CC@
CFLAGS	= -I${srcdir} -I${srcdir}/.. -I. -I.. @INCLUDES@ -DHAVE_TNFTPD_H=1 @CFLAGS@ -D_DEFAULT_CONFDIR=\"${sysconfdir}\"
LIBS	= @LIBS@
LDFLAGS	= @LDFLAGS@
YACC	= @YACC@
MKDIR	= @MKDIR_P@

INSTALL	= @INSTALL@

OBJS	= ${SRCS:.c=.o}

seddotin = sed \
		-e 's|@datadir[@]|${datadir}|g' \
		-e 's|@sysconfdir[@]|${sysconfdir}|g'


all:	${PROG} ${MAN} ${CAT}


cmp.o: ${srcdir}/../ls/cmp.c
	${CC} ${CFLAGS} -c  -o cmp.o ${srcdir}/../ls/cmp.c

ls.o: ${srcdir}/../ls/ls.c
	${CC} ${CFLAGS} -c  -o ls.o ${srcdir}/../ls/ls.c

print.o: ${srcdir}/../ls/print.c
	${CC} ${CFLAGS} -c  -o print.o ${srcdir}/../ls/print.c

util.o: ${srcdir}/../ls/util.c
	${CC} ${CFLAGS} -c  -o util.o ${srcdir}/../ls/util.c

${PROG}: ${OBJS} @LIBDEPENDS@
	${CC} ${CFLAGS} ${LDFLAGS} -o ${PROG} ${OBJS} ${LIBS}


.SUFFIXES: .manin .man .cat

.manin.man:
	${seddotin} $< > $@

.man.cat:
	nroff -man $< > $@


install: all install-prog install-man

install-prog: ${PROG}
	-${MKDIR} ${sbindir}
	${INSTALL} -m 555 ${PROG} ${sbindir}

install-man: ${MAN}
	-${MKDIR} ${man5dir}
	${INSTALL} -m 444 ftpd.conf.man ${man5dir}/ftpd.conf${man5ext}
	${INSTALL} -m 444 ftpusers.man ${man5dir}/ftpusers${man5ext}
	-${MKDIR} ${man8dir}
	${INSTALL} -m 444 ${PROG}.man ${man8dir}/${PROG}${man8ext}

install-cat: ${CAT}
	-${MKDIR} ${cat5dir}
	${INSTALL} -m 444 ftpd.conf.cat ${cat5dir}/ftpd.conf${cat5ext}
	${INSTALL} -m 444 ftpusers.cat ${cat5dir}/ftpusers${cat5ext}
	-${MKDIR} ${cat8dir}
	${INSTALL} -m 444 ${PROG}.cat ${cat8dir}/${PROG}${cat8ext}


clean:
	rm -f core ${PROG} ${OBJS} ${MAN} ${CAT}

distclean: clean
	rm -f Makefile


.PHONY: all install install-prog install-man install-cat clean distclean
