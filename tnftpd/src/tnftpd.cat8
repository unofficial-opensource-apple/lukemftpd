TNFTPD(8)               NetBSD System Manager's Manual               TNFTPD(8)

NNAAMMEE
     ttnnffttppdd - Internet File Transfer Protocol server

SSYYNNOOPPSSIISS
     ttnnffttppdd [--ddHHllqqQQrrssuuUUwwWWXX] [--aa _a_n_o_n_d_i_r] [--cc _c_o_n_f_d_i_r] [--CC _u_s_e_r] [--ee _e_m_a_i_l_a_d_d_r]
            [--hh _h_o_s_t_n_a_m_e] [--LL _x_f_e_r_l_o_g_f_i_l_e] [--PP _d_a_t_a_p_o_r_t] [--VV _v_e_r_s_i_o_n]

DDEESSCCRRIIPPTTIIOONN
     ttnnffttppdd is the Internet File Transfer Protocol server process.  The server
     uses the TCP protocol and listens at the port specified in the ``ftp''
     service specification; see services(5).

     Available options:

     --aa _a_n_o_n_d_i_r
             Define _a_n_o_n_d_i_r as the directory to chroot(2) into for anonymous
             logins.  Default is the home directory for the ftp user.  This
             can also be specified with the ftpd.conf(5) cchhrroooott directive.

     --cc _c_o_n_f_d_i_r
             Change the root directory of the configuration files from
             ``_/_e_t_c'' to _c_o_n_f_d_i_r.  This changes the directory for the follow-
             ing files: _/_e_t_c_/_f_t_p_c_h_r_o_o_t, _/_e_t_c_/_f_t_p_u_s_e_r_s, _/_e_t_c_/_f_t_p_w_e_l_c_o_m_e,
             _/_e_t_c_/_m_o_t_d, and the file specified by the ftpd.conf(5) lliimmiitt
             directive.

     --CC _u_s_e_r
             Check whether _u_s_e_r would be granted access under the restrictions
             given in ftpusers(5) and exit without attempting a connection.
             ttnnffttppdd exits with an exit code of 0 if access would be granted,
             or 1 otherwise.  This can be useful for testing configurations.

     --dd      Debugging information is written to the syslog using a facility
             of LOG_FTP.

     --ee _e_m_a_i_l_a_d_d_r
             Use _e_m_a_i_l_a_d_d_r for the ``%E'' escape sequence (see _D_i_s_p_l_a_y _f_i_l_e
             _e_s_c_a_p_e _s_e_q_u_e_n_c_e_s)

     --hh _h_o_s_t_n_a_m_e
             Explicitly set the hostname to advertise as to _h_o_s_t_n_a_m_e.  The
             default is the hostname associated with the IP address that
             ttnnffttppdd is listening on.  This ability (with or without --hh), in
             conjunction with --cc _c_o_n_f_d_i_r, is useful when configuring `virtual'
             FTP servers, each listening on separate addresses as separate
             names.  Refer to inetd.conf(5) for more information on starting
             services to listen on specific IP addresses.

     --HH      Equivalent to ``-h `hostname`''.

     --ll      Each successful and failed FTP session is logged using syslog
             with a facility of LOG_FTP.  If this option is specified more
             than once, the retrieve (get), store (put), append, delete, make
             directory, remove directory and rename operations and their file
             name arguments are also logged.

     --LL _x_f_e_r_l_o_g_f_i_l_e
             Log wu-ftpd style `xferlog' entries to _x_f_e_r_l_o_g_f_i_l_e.

     --PP _d_a_t_a_p_o_r_t
             Use _d_a_t_a_p_o_r_t as the data port, overriding the default of using
             the port one less that the port ttnnffttppdd is listening on.

     --qq      Enable the use of pid files for keeping track of the number of
             logged-in users per class.  This is the default.

     --QQ      Disable the use of pid files for keeping track of the number of
             logged-in users per class.  This may reduce the load on heavily
             loaded FTP servers.

     --rr      Permanently drop root privileges once the user is logged in.  The
             use of this option may result in the server using a port other
             than the (listening-port - 1) for PPOORRTT style commands, which is
             contrary to the RRFFCC 995599 specification, but in practice very few
             clients rely upon this behaviour.  See _S_E_C_U_R_I_T_Y _C_O_N_S_I_D_E_R_A_T_I_O_N_S
             below for more details.

     --ss      Require a secure authentication mechanism like Kerberos or S/Key
             to be used.

     --uu      Log each concurrent FTP session to _/_v_a_r_/_r_u_n_/_u_t_m_p, making them
             visible to commands such as who(1).

     --UU      Don't log each concurrent FTP session to _/_v_a_r_/_r_u_n_/_u_t_m_p.  This is
             the default.

     --VV _v_e_r_s_i_o_n
             Use _v_e_r_s_i_o_n as the version to advertise in the login banner and
             in the output of SSTTAATT and SSYYSSTT instead of the default version
             information.  If _v_e_r_s_i_o_n is empty or `-' then don't display any
             version information.

     --ww      Log each FTP session to _/_v_a_r_/_l_o_g_/_w_t_m_p, making them visible to
             commands such as last(1).  This is the default.

     --WW      Don't log each FTP session to _/_v_a_r_/_l_o_g_/_w_t_m_p.

     --XX      Log wu-ftpd style `xferlog' entries to the syslog, prefixed with
             ``xferlog: '', using a facility of LOG_FTP.  These syslog entries
             can be converted to a wu-ftpd style _x_f_e_r_l_o_g file suitable for
             input into a third-party log analysis tool with a command similar
             to:
                   grep 'xferlog: ' /var/log/xferlog | \
                      sed -e 's/^.*xferlog: //' > wuxferlog

     The file _/_e_t_c_/_n_o_l_o_g_i_n can be used to disable FTP access.  If the file
     exists, ttnnffttppdd displays it and exits.  If the file _/_e_t_c_/_f_t_p_w_e_l_c_o_m_e
     exists, ttnnffttppdd prints it before issuing the ``ready'' message.  If the
     file _/_e_t_c_/_m_o_t_d exists (under the chroot directory if applicable), ttnnffttppdd
     prints it after a successful login.  This may be changed with the
     ftpd.conf(5) directive mmoottdd.

     The ttnnffttppdd server currently supports the following FTP requests.  The
     case of the requests is ignored.

           RReeqquueesstt    DDeessccrriippttiioonn
           ABOR       abort previous command
           ACCT       specify account (ignored)
           ALLO       allocate storage (vacuously)
           APPE       append to a file
           CDUP       change to parent of current working directory
           CWD        change working directory
           DELE       delete a file
           EPSV       prepare for server-to-server transfer
           EPRT       specify data connection port
           FEAT       list extra features that are not defined in RRFFCC 995599
           HELP       give help information
           LIST       give list files in a directory (``ls -lA'')
           LPSV       prepare for server-to-server transfer
           LPRT       specify data connection port
           MLSD       list contents of directory in a machine-processable form
           MLST       show a pathname in a machine-processable form
           MKD        make a directory
           MDTM       show last modification time of file
           MODE       specify data transfer _m_o_d_e
           NLST       give name list of files in directory
           NOOP       do nothing
           OPTS       define persistent options for a given command
           PASS       specify password
           PASV       prepare for server-to-server transfer
           PORT       specify data connection port
           PWD        print the current working directory
           QUIT       terminate session
           REST       restart incomplete transfer
           RETR       retrieve a file
           RMD        remove a directory
           RNFR       specify rename-from file name
           RNTO       specify rename-to file name
           SITE       non-standard commands (see next section)
           SIZE       return size of file
           STAT       return status of server
           STOR       store a file
           STOU       store a file with a unique name
           STRU       specify data transfer _s_t_r_u_c_t_u_r_e
           SYST       show operating system type of server system
           TYPE       specify data transfer _t_y_p_e
           USER       specify user name
           XCUP       change to parent of current working directory
                      (deprecated)
           XCWD       change working directory (deprecated)
           XMKD       make a directory (deprecated)
           XPWD       print the current working directory (deprecated)
           XRMD       remove a directory (deprecated)

     The following non-standard or UNIX specific commands are supported by the
     SITE request.

           RReeqquueesstt    DDeessccrriippttiioonn
           CHMOD      change mode of a file, e.g. ``SITE CHMOD 755 filename''
           HELP       give help information.
           IDLE       set idle-timer, e.g. ``SITE IDLE 60''
           RATEGET    set maximum get rate throttle in bytes/second, e.g.
                      ``SITE RATEGET 5k''
           RATEPUT    set maximum put rate throttle in bytes/second, e.g.
                      ``SITE RATEPUT 5k''
           UMASK      change umask, e.g. ``SITE UMASK 002''

     The following FTP requests (as specified in RRFFCC 995599) are recognized, but
     are not implemented: AACCCCTT, SSMMNNTT, and RREEIINN.  MMDDTTMM and SSIIZZEE are not speci-
     fied in RRFFCC 995599, but will appear in the next updated FTP RFC.

     The ttnnffttppdd server will abort an active file transfer only when the AABBOORR
     command is preceded by a Telnet "Interrupt Process" (IP) signal and a
     Telnet "Synch" signal in the command Telnet stream, as described in
     Internet RRFFCC 995599.  If a SSTTAATT command is received during a data transfer,
     preceded by a Telnet IP and Synch, transfer status will be returned.

     ttnnffttppdd interprets file names according to the ``globbing'' conventions
     used by csh(1).  This allows users to use the metacharacters ``*?[]{}~''.

   UUsseerr aauutthheennttiiccaattiioonn
     ttnnffttppdd authenticates users according to five rules.

           1.   The login name must be in the password data base, _/_e_t_c_/_p_w_d_._d_b,
                and not have a null password.  In this case a password must be
                provided by the client before any file operations may be per-
                formed.  If the user has an S/Key key, the response from a
                successful UUSSEERR command will include an S/Key challenge.  The
                client may choose to respond with a PPAASSSS command giving either
                a standard password or an S/Key one-time password.  The server
                will automatically determine which type of password it has
                been given and attempt to authenticate accordingly.  See
                skey(1) for more information on S/Key authentication.  S/Key
                is a Trademark of Bellcore.

           2.   The login name must be allowed based on the information in
                ftpusers(5).

           3.   The user must have a standard shell returned by
                getusershell(3).  If the user's shell field in the password
                database is empty, the shell is assumed to be _/_b_i_n_/_s_h.  As per
                shells(5), the user's shell must be listed with full path in
                _/_e_t_c_/_s_h_e_l_l_s.

           4.   If directed by the file ftpchroot(5) the session's root direc-
                tory will be changed by chroot(2) to the directory specified
                in the ftpd.conf(5) cchhrroooott directive (if set), or to the home
                directory of the user.  However, the user must still supply a
                password.  This feature is intended as a compromise between a
                fully anonymous account and a fully privileged account.  The
                account should also be set up as for an anonymous account.

           5.   If the user name is ``anonymous'' or ``ftp'', an anonymous FTP
                account must be present in the password file (user ``ftp'').
                In this case the user is allowed to log in by specifying any
                password (by convention an email address for the user should
                be used as the password).

                The server performs a chroot(2) to the directory specified in
                the ftpd.conf(5) cchhrroooott directive (if set), the --aa _a_n_o_n_d_i_r
                directory (if set), or to the home directory of the ``ftp''
                user.

                The server then performs a chdir(2) to the directory specified
                in the ftpd.conf(5) hhoommeeddiirr directive (if set), otherwise to
                _/.

                If other restrictions are required (such as disabling of cer-
                tain commands and the setting of a specific umask), then
                appropriate entries in ftpd.conf(5) are required.

                If the first character of the password supplied by an anony-
                mous user is ``-'', then the verbose messages displayed at
                login and upon a CCWWDD command are suppressed.

   DDiissppllaayy ffiillee eessccaappee sseeqquueenncceess
     When ttnnffttppdd displays various files back to the client (such as
     _/_e_t_c_/_f_t_p_w_e_l_c_o_m_e and _/_e_t_c_/_m_o_t_d), various escape strings are replaced with
     information pertinent to the current connection.

     The supported escape strings are:
           EEssccaappee  DDeessccrriippttiioonn
           %c      Class name.
           %C      Current working directory.
           %E      Email address given with --ee.
           %L      Local hostname.
           %M      Maximum number of users for this class.  Displays
                   ``unlimited'' if there's no limit.
           %N      Current number of users for this class.
           %R      Remote hostname.
           %s      If the result of the most recent ``%M'' or ``%N'' was not
                   ``1'', print an ``s''.
           %S      If the result of the most recent ``%M'' or ``%N'' was not
                   ``1'', print an ``S''.
           %T      Current time.
           %U      User name.
           %%      A ``%'' character.

   SSeettttiinngg uupp aa rreessttrriicctteedd ffttpp ssuubbttrreeee
     In order that system security is not breached, it is recommended that the
     subtrees for the ``ftp'' and ``chroot'' accounts be constructed with
     care, following these rules (replace ``ftp'' in the following directory
     names with the appropriate account name for `chroot' users):

           _~_f_t_p           Make the home directory owned by ``root'' and
                          unwritable by anyone.

           _~_f_t_p_/_b_i_n       Make this directory owned by ``root'' and unwritable
                          by anyone (mode 555).  Generally any conversion com-
                          mands should be installed here (mode 111).

           _~_f_t_p_/_e_t_c       Make this directory owned by ``root'' and unwritable
                          by anyone (mode 555).  The files _p_w_d_._d_b (see
                          passwd(5)) and _g_r_o_u_p (see group(5)) must be present
                          for the LLIISSTT command to be able to display owner and
                          group names instead of numbers.  The password field
                          in passwd(5) is not used, and should not contain
                          real passwords.  The file _m_o_t_d, if present, will be
                          printed after a successful login.  These files
                          should be mode 444.

           _~_f_t_p_/_p_u_b       This directory and the subdirectories beneath it
                          should be owned by the users and groups responsible
                          for placing files in them, and be writable only by
                          them (mode 755 or 775).  They should _n_o_t be owned or
                          writable by ftp or its group.

           _~_f_t_p_/_i_n_c_o_m_i_n_g  This directory is where anonymous users place files
                          they upload.  The owners should be the user ``ftp''
                          and an appropriate group.  Members of this group
                          will be the only users with access to these files
                          after they have been uploaded; these should be peo-
                          ple who know how to deal with them appropriately.
                          If you wish anonymous FTP users to be able to see
                          the names of the files in this directory the permis-
                          sions should be 770, otherwise they should be 370.

                          The following ftpd.conf(5) directives should be
                          used:
                                modify guest off
                                umask  guest 0707
                                upload guest on

                          This will result in anonymous users being able to
                          upload files to this directory, but they will not be
                          able to download them, delete them, or overwrite
                          them, due to the umask and disabling of the commands
                          mentioned above.

           _~_f_t_p_/_t_m_p       This directory is used to create temporary files
                          which contain the error messages generated by a con-
                          version or LLIISSTT command.  The owner should be the
                          user ``ftp''.  The permissions should be 300.

                          If you don't enable conversion commands, or don't
                          want anonymous users uploading files here (see
                          _~_f_t_p_/_i_n_c_o_m_i_n_g above), then don't create this direc-
                          tory.  However, error messages from conversion or
                          LLIISSTT commands won't be returned to the user.  (This
                          is the traditional behaviour.)  Note that the
                          ftpd.conf(5) directive uuppllooaadd can be used to prevent
                          users uploading here.

     To set up "ftp-only" accounts that provide only FTP, but no valid shell
     login, you can copy/link _/_s_b_i_n_/_n_o_l_o_g_i_n to _/_s_b_i_n_/_f_t_p_l_o_g_i_n, and enter
     _/_s_b_i_n_/_f_t_p_l_o_g_i_n to _/_e_t_c_/_s_h_e_l_l_s to allow logging-in via FTP into the
     accounts, which must have _/_s_b_i_n_/_f_t_p_l_o_g_i_n as login shell.

FFIILLEESS
     /etc/ftpchroot   List of normal users whose root directory should be
                      changed via chroot(2).
     /etc/ftpd.conf   Configure file conversions and other settings.
     /etc/ftpusers    List of unwelcome/restricted users.
     /etc/ftpwelcome  Welcome notice before login.
     /etc/motd        Welcome notice after login.
     /etc/nologin     If it exists, displayed and access is refused.
     /var/run/ftpd.pids-CLASS
                      State file of logged-in processes for the ttnnffttppdd class
                      `CLASS'.
     /var/run/utmp    List of logged-in users on the system.
     /var/log/wtmp    Login history database.

SSEEEE AALLSSOO
     ftp(1), skey(1), who(1), getusershell(3), ftpchroot(5), ftpd.conf(5),
     ftpusers(5), syslogd(8)

SSTTAANNDDAARRDDSS
     ttnnffttppdd recognizes all commands in RRFFCC 995599, follows the guidelines in RRFFCC
     11112233, recognizes all commands in RRFFCC 22222288 (although they are not sup-
     ported yet), and supports the extensions from RRFFCC 22338899, RRFFCC 22442288 and
     ddrraafftt--iieettff--ffttppeexxtt--mmllsstt--1111.

HHIISSTTOORRYY
     The ttnnffttppdd command appeared in 4.2BSD.

     Various features such as the ftpd.conf(5) functionality, RRFFCC 22338899, and
     ddrraafftt--iieettff--ffttppeexxtt--mmllsstt--1111 support was implemented in NetBSD 1.3 and later
     releases by Luke Mewburn.

BBUUGGSS
     The server must run as the super-user to create sockets with privileged
     port numbers (i.e, those less than IPPORT_RESERVED, which is 1024).  If
     ttnnffttppdd is listening on a privileged port it maintains an effective user
     id of the logged in user, reverting to the super-user only when binding
     addresses to privileged sockets.  The --rr option can be used to override
     this behaviour and force privileges to be permanently revoked; see
     _S_E_C_U_R_I_T_Y _C_O_N_S_I_D_E_R_A_T_I_O_N_S below for more details.

     ttnnffttppdd may have trouble handling connections from scoped IPv6 addresses,
     or IPv4 mapped addresses (IPv4 connection on AF_INET6 socket).  For the
     latter case, running two daemons, one for IPv4 and one for IPv6, will
     avoid the problem.

SSEECCUURRIITTYY CCOONNSSIIDDEERRAATTIIOONNSS
     RRFFCC 995599 provides no restrictions on the PPOORRTT command, and this can lead
     to security problems, as ttnnffttppdd can be fooled into connecting to any ser-
     vice on any host.  With the ``checkportcmd'' feature of the ftpd.conf(5),
     PPOORRTT commands with different host addresses, or TCP ports lower than
     IPPORT_RESERVED will be rejected.  This also prevents `third-party proxy
     ftp' from working.  Use of this option is _s_t_r_o_n_g_l_y recommended, and
     enabled by default.

     By default ttnnffttppdd uses a port that is one less than the port it is lis-
     tening on to communicate back to the client for the EEPPRRTT, LLPPRRTT, and PPOORRTT
     commands, unless overridden with --PP _d_a_t_a_p_o_r_t.  As the default port for
     ttnnffttppdd (21) is a privileged port below IPPORT_RESERVED, ttnnffttppdd retains
     the ability to switch back to root privileges to bind these ports.  In
     order to increase security by reducing the potential for a bug in ttnnffttppdd
     providing a remote root compromise, ttnnffttppdd will permanently drop root
     privileges if one of the following is true:

           1.   ttnnffttppdd is running on a port greater than IPPORT_RESERVED and
                the user has logged in as a `guest' or `chroot' user.

           2.   ttnnffttppdd was invoked with --rr.

     Don't create _~_f_t_p_/_t_m_p if you don't want anonymous users to upload files
     there.  That directory is only necessary if you want to display the error
     messages of conversion commands to the user.  Note that if uploads are
     disabled with the ftpd.conf(5) directive uuppllooaadd, then this directory can-
     not be abused by the user in this way, so it should be safe to create.

NetBSD 1.6                     February 28, 2003                    NetBSD 1.6
